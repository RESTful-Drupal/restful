/**
 * restful-app
 * @version v0.0.1 - 2014-07-07
 * @link 
 * @author  <>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("restfulApp",["angularFileUpload"],function(a){a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var b=function(a){var c,d,e,f,g,h,i,j="";for(c in a)if(d=a[c],d instanceof Array)for(i=0;i<d.length;++i)g=d[i],e=c+"["+i+"]",h={},h[e]=g,j+=b(h)+"&";else if(d instanceof Object)for(f in d)g=d[f],e=c+"["+f+"]",h={},h[e]=g,j+=b(h)+"&";else void 0!==d&&null!==d&&(j+=encodeURIComponent(c)+"="+encodeURIComponent(d)+"&");return j.length?j.substr(0,j.length-1):j};a.defaults.transformRequest=[function(a){var c=angular.isObject(a)&&"[object File]"!==String(a)?b(a):a;return c}]}),angular.module("restfulApp").controller("MainCtrl",["$scope","DrupalSettings","ArticlesResource","FileUpload","$log",function(a,b,c,d,e){a.data=b.getData("article"),a.serverSide={},a.submitForm=function(){e.info(a.article.$valid?"valid":"not valid, but checking server side"),e.log(a.data),c.createArticle(a.data).success(function(b,c){a.serverSide.data=b,a.serverSide.status=c,e.log(a.serverSide)}).error(function(b,c){a.serverSide.data=b,a.serverSide.status=c,e.log(a.serverSide)}),e.log()},a.onFileSelect=function(b){for(var c=0;c<b.length;c++){var e=b[c];d.upload(e).then(function(b){a.data.image=b.data.list[0].id,a.serverSide.image=b.data.list[0]})}}}]),angular.module("restfulApp").service("ArticlesResource",["DrupalSettings","$http","$log",function(a,b){this.createArticle=function(c){var d={withCredentials:!0,headers:{"X-CSRF-Token":a.getCsrfToken(),"X-Restful-Minor-Version":5}};return b.post(a.getBasePath()+"api/v1/articles",c,d)}}]),angular.module("restfulApp").service("DrupalSettings",["$window",function(a){var b=this;this.settings=a.Drupal.settings,this.getBasePath=function(){return angular.isDefined(b.settings.restfulExample.basePath)?b.settings.restfulExample.basePath:void 0},this.getCsrfToken=function(){return angular.isDefined(b.settings.restfulExample.csrfToken)?b.settings.restfulExample.csrfToken:void 0},this.getData=function(a){return angular.isDefined(b.settings.restfulExample.data[a])?b.settings.restfulExample.data[a]:{}}}]),angular.module("restfulApp").service("FileUpload",["DrupalSettings","$upload","$log",function(a,b){this.upload=function(c){return b.upload({url:a.getBasePath()+"api/file-upload",method:"POST",file:c,withCredentials:!0,headers:{"X-CSRF-Token":a.getCsrfToken()}})}}]);